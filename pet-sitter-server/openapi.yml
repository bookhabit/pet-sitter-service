openapi: 3.0.3
info:
  title: PetSitter API
  version: "0.1"
tags:
  - name: Users
    description: User-related operations
  - name: Jobs
    description: Job-related operations
  - name: Photos
    description: Photo upload and management
  - name: Reviews
    description: Review and rating operations
  - name: Favorites
    description: Favorites (bookmark) operations for PetSitters
paths:
  /users:
    post:
      tags:
      - Users
      summary: Register User
      operationId: registerUser
      responses:
        '201':
          description: Created
          headers:
            Location:
              schema:
                type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUserRequest'
      security: []
  /users/{id}:
    parameters:
      - schema:
          type: string
        name: id
        in: path
        required: true
    get:
      tags:
      - Users
      summary: View User
      operationId: viewUserWithId
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
    put:
      tags:
      - Users
      summary: Modify User
      operationId: modifyUserWithId
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserRequest'
    delete:
      tags:
      - Users
      summary: Delete User
      operationId: deleteUserWithId
      responses:
        '204':
          description: No Content
  /jobs:
    post:
      tags:
      - Jobs
      summary: Create Job
      operationId: createJob
      responses:
        '201': 
          description: Created
          headers:
            Location:
              schema:
                type: string
        '400': 
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OASError' 
        '401': 
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OASError' 
        '403': 
          description: Forbidden
          content:
            application/problem+json: 
              schema:
                $ref: '#/components/schemas/Problem'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateJobRequest'
    get:
      tags:
      - Jobs
      summary: List/Search Available Jobs
      operationId: listOrSearchAvailableJobs
      parameters:
      - name: start_time_before
        in: query
        description: Search jobs starting before this date and time.
        schema:
          type: string
          format: date-time
      - name: start_time_after
        in: query
        description: Search jobs starting after this date and time.
        schema:
          type: string
          format: date-time
      - name: end_time_before
        in: query
        description: Search jobs ending before this date and time.
        schema:
          type: string
          format: date-time
      - name: end_time_after
        in: query
        description: Search jobs ending after this date and time.
        schema:
          type: string
          format: date-time
      - name: activity
        in: query
        description: Performs a full-text search for the phrase entered in job activities.
        schema:
          type: string
      - name: pets[age_below]
        in: query
        description: Return only pets with this age or younger.
        schema:
          type: integer
          minimum: 1
      - name: pets[age_above]
        in: query
        description: Return only pets with this age or older.
        schema:
          type: integer
          minimum: 1
      - name: pets[species]
        in: query
        description: Return only pets with this species. Provide multiple species as comma-separated values (e.g., "Cat,Dog").
        schema:
          type: string
      - name: limit
        in: query
        description: The maximum number of results to return.
        schema:
          type: integer
          default: 20
          maximum: 100
      - name: cursor
        in: query
        description: Use the cursor from the response to access more results.
        schema:
          type: string
      - name: sort
        in: query
        description: |
          Indicate the sorting key and direction for the results.
          Use the field name, suffixed with ":asc" for ascending
          or ":desc" for descending order.
          Valid fields: start_time, end_time
        schema:
          type: string
      - name: min_price
        in: query
        description: Return only jobs with price >= this value.
        schema:
          type: integer
          minimum: 0
      - name: max_price
        in: query
        description: Return only jobs with price <= this value.
        schema:
          type: integer
          minimum: 0
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Job'
                  cursor:
                    type: string
                    description: Cursor for the next result page.
                    nullable: true
  /jobs/{id}:
    parameters:
      - schema:
          type: string
        name: id
        in: path
        required: true
    get:
      tags:
      - Jobs
      summary: View Job
      operationId: viewJobWithId
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Job'
    put:
      tags:
      - Jobs
      summary: Modify Job
      operationId: modifyJobWithId
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Job'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateJobRequest'
    delete:
      tags:
      - Jobs
      summary: Delete Job
      operationId: deleteJobWithId
      responses:
        '204':
          description: No Content
  /jobs/{id}/job-applications:
    parameters:
      - schema:
          type: string
        name: id
        in: path
        required: true
    get:
      tags:
      - Jobs
      summary: List Applications For Job
      operationId: viewApplicationsForJob
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/JobApplication'
    post:
      tags:
      - Jobs
      summary: Create Job Application
      operationId: createJobApplication
      responses:
        '201':
          description: Created
          headers:
            Location:
              schema:
                type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              description: Empty body - job_id comes from path, user_id from authentication
  /users/{id}/jobs:
    parameters:
      - schema:
          type: string
        name: id
        in: path
        required: true
    get:
      tags:
      - Users
      summary: List Jobs For User
      operationId: listJobsForUser
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Job'
  /users/{id}/job-applications:
    parameters:
    - name: id
      in: path
      required: true
      schema:
        type: integer
    get:
      tags:
      - Users
      summary: List Applications For User
      operationId: viewApplicationsForUser
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/JobApplication'
  /job-applications/{id}:
    parameters:
      - schema:
          type: string
        name: id
        in: path
        required: true
    put:
      tags:
      - Jobs
      summary: Modify Job Application
      operationId: modifyJobApplicationWithId
      requestBody:
        description: Update the application details
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JobApplication'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobApplication'
  /photos/upload:
    post:
      tags:
      - Photos
      summary: Upload Multiple Photos (Pre-upload)
      description: |
        여러 파일을 한 번에 업로드합니다. entity와 미연결 상태(orphan)로 저장됩니다.
        반환된 Photo IDs를 POST /jobs 등의 요청 body에 포함해 연결하세요.
      operationId: uploadPhotos
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - files
              properties:
                files:
                  type: array
                  items:
                    type: string
                    format: binary
                  maxItems: 10
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Photo'
        '400':
          description: Bad Request (invalid file type or size)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OASError'
  /users/{id}/photos:
    parameters:
      - schema:
          type: string
        name: id
        in: path
        required: true
    post:
      tags:
      - Photos
      summary: Upload User Profile Photo
      operationId: uploadUserPhoto
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
              properties:
                file:
                  type: string
                  format: binary
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Photo'
        '400':
          description: Bad Request (invalid file type or size)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OASError'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OASError'
  /jobs/{id}/photos:
    parameters:
      - schema:
          type: string
        name: id
        in: path
        required: true
    post:
      tags:
      - Photos
      summary: Upload Job Photo
      operationId: uploadJobPhoto
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
              properties:
                file:
                  type: string
                  format: binary
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Photo'
        '400':
          description: Bad Request (invalid file type or size)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OASError'
        '404':
          description: Job not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OASError'
  /pets/{id}/photos:
    parameters:
      - schema:
          type: string
        name: id
        in: path
        required: true
    post:
      tags:
      - Photos
      summary: Upload Pet Photo
      operationId: uploadPetPhoto
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
              properties:
                file:
                  type: string
                  format: binary
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Photo'
        '400':
          description: Bad Request (invalid file type or size)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OASError'
        '404':
          description: Pet not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OASError'
  /photos/{id}:
    parameters:
      - schema:
          type: string
        name: id
        in: path
        required: true
    delete:
      tags:
      - Photos
      summary: Delete Photo
      operationId: deletePhoto
      responses:
        '204':
          description: No Content
        '403':
          description: Forbidden (not the uploader)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OASError'
        '404':
          description: Photo not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OASError'
  /favorites:
    post:
      tags:
      - Favorites
      summary: Toggle Favorite
      description: |
        즐겨찾기 토글. 이미 등록되어 있으면 제거, 없으면 추가합니다. (PetSitter 전용)
      operationId: toggleFavorite
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ToggleFavoriteRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ToggleFavoriteResult'
        '404':
          description: Job not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OASError'
    get:
      tags:
      - Favorites
      summary: List My Favorites
      description: 내 즐겨찾기 공고 목록을 조회합니다. (PetSitter 전용)
      operationId: listMyFavorites
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Job'
  /favorites/{jobId}:
    parameters:
      - schema:
          type: string
        name: jobId
        in: path
        required: true
        description: 즐겨찾기에서 제거할 공고 ID
    delete:
      tags:
      - Favorites
      summary: Remove Favorite
      description: 즐겨찾기에서 특정 공고를 제거합니다. (PetSitter 전용)
      operationId: removeFavorite
      responses:
        '204':
          description: No Content
        '404':
          description: Favorite not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OASError'
  /sessions:
    post:
      tags:
      - Users
      summary: Start Session (Login)
      operationId: startSession
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Session'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                password:
                  type: string
      security: []
  /jobs/{jobId}/reviews:
    parameters:
      - schema:
          type: string
        name: jobId
        in: path
        required: true
    post:
      tags:
      - Reviews
      summary: Create Review
      description: |
        PetOwner 또는 PetSitter가 리뷰를 작성합니다.
        - PetOwner: 본인 공고의 approved PetSitter에게 리뷰 작성
        - PetSitter: 본인이 approved된 공고의 PetOwner에게 리뷰 작성
        공고당 작성자 1인 1리뷰 (양방향 허용: 최대 2개/공고)
      operationId: createReview
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateReviewRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Review'
        '400':
          description: No approved applicant exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OASError'
        '403':
          description: Not authorized to review this job
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OASError'
        '404':
          description: Job not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OASError'
        '409':
          description: Review already exists for this job by this user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OASError'
  /users/{userId}/reviews:
    parameters:
      - schema:
          type: string
        name: userId
        in: path
        required: true
    get:
      tags:
      - Reviews
      summary: List Reviews For User
      description: 특정 사용자가 받은 리뷰 목록을 조회합니다.
      operationId: listReviewsForUser
      parameters:
        - name: sort
          in: query
          description: |
            정렬 기준. 유효 값: createdAt:desc (기본), createdAt:asc, rating:desc, rating:asc
          schema:
            type: string
            enum:
              - createdAt:desc
              - createdAt:asc
              - rating:desc
              - rating:asc
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Review'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OASError'
  /reviews/{id}:
    parameters:
      - schema:
          type: string
        name: id
        in: path
        required: true
    delete:
      tags:
      - Reviews
      summary: Delete Review
      description: 리뷰 작성자만 삭제할 수 있습니다.
      operationId: deleteReview
      responses:
        '204':
          description: No Content
        '403':
          description: Not the reviewer
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OASError'
        '404':
          description: Review not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OASError'
components:
  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
          readOnly: true
        email:
          type: string
          format: email
        password:
          type: string
          format: password
          writeOnly: true
          minLength: 8
        full_name:
          type: string
          minLength: 2
          maxLength: 50
        roles:
          type: array
          minItems: 1
          uniqueItems: true
          items:
            type: string
            enum:
              - PetOwner
              - PetSitter
              - Admin
        photos:
          type: array
          readOnly: true
          description: 프로필 사진 목록
          items:
            $ref: '#/components/schemas/Photo'
      required:
        - email
        - full_name
        - roles
    CreateUserRequest:
      type: object
      required:
        - email
        - password
        - full_name
        - roles
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          format: password
          minLength: 8
        full_name:
          type: string
          minLength: 2
          maxLength: 50
        roles:
          type: array
          minItems: 1
          uniqueItems: true
          items:
            type: string
            enum:
              - PetOwner
              - PetSitter
              - Admin
    UpdateUserRequest:
      type: object
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          format: password
          minLength: 8
        full_name:
          type: string
          minLength: 2
          maxLength: 50
        roles:
          type: array
          minItems: 1
          uniqueItems: true
          items:
            type: string
            enum:
              - PetOwner
              - PetSitter
              - Admin
    Job:
      type: object
      properties:
        id:
          type: integer
          readOnly: true 
        creator_user_id:
          type: integer
          readOnly: true 
        start_time:
          type: string
          format: date-time 
        end_time:
          type: string
          format: date-time 
        activity:
          type: string
          minLength: 5 
          maxLength: 500
        pets:
          type: array
          minItems: 1
          maxItems: 10
          items:
            $ref: '#/components/schemas/Pet'
        address:
          type: string
          nullable: true
          description: 공고 위치 주소 (예: 서울 강남구 역삼동)
        latitude:
          type: number
          format: float
          nullable: true
          description: 위도 (WGS84)
        longitude:
          type: number
          format: float
          nullable: true
          description: 경도 (WGS84)
        price:
          type: integer
          minimum: 0
          nullable: true
          description: 가격 (원 단위)
        price_type:
          type: string
          nullable: true
          enum: [hourly, daily]
          description: 가격 단위 (시간당 / 일당)
        photos:
          type: array
          readOnly: true
          description: 공고에 첨부된 사진 목록
          items:
            $ref: '#/components/schemas/Photo'
      required:
      - id
      - creator_user_id
      - start_time
      - end_time
      - pets
    CreateJobRequest:
      type: object
      required:
        - start_time
        - end_time
        - activity
        - pets
      properties:
        start_time:
          type: string
          format: date-time
        end_time:
          type: string
          format: date-time
        activity:
          type: string
          minLength: 5
          maxLength: 500
        pets:
          type: array
          minItems: 1
          maxItems: 10
          items:
            $ref: '#/components/schemas/CreatePetRequest'
        address:
          type: string
          description: 공고 위치 주소 (선택)
        latitude:
          type: number
          format: float
          description: 위도 (선택)
        longitude:
          type: number
          format: float
          description: 경도 (선택)
        price:
          type: integer
          minimum: 0
          description: 가격 원 단위 (선택)
        price_type:
          type: string
          enum: [hourly, daily]
          description: 가격 단위 - hourly(시간당) / daily(일당) (선택)
        photo_ids:
          type: array
          items:
            type: string
            format: uuid
          description: POST /photos/upload 으로 사전 업로드한 공고 사진 ID 목록
    UpdateJobRequest:
      type: object
      properties:
        start_time:
          type: string
          format: date-time
        end_time:
          type: string
          format: date-time
        activity:
          type: string
          minLength: 5
          maxLength: 500
        pets:
          type: array
          minItems: 1
          maxItems: 10
          items:
            $ref: '#/components/schemas/CreatePetRequest'
        address:
          type: string
          description: 공고 위치 주소 (선택)
        latitude:
          type: number
          format: float
          description: 위도 (선택)
        longitude:
          type: number
          format: float
          description: 경도 (선택)
        price:
          type: integer
          minimum: 0
          description: 가격 원 단위 (선택)
        price_type:
          type: string
          enum: [hourly, daily]
          description: 가격 단위 - hourly(시간당) / daily(일당) (선택)
    Pet:
      type: object
      properties:
        id:
          type: string
          readOnly: true
        name:
          type: string
          minLength: 2
          maxLength: 20
        age:
          type: integer
          minimum: 1
          maximum: 100
        species:
          type: string
          enum: [Cat, Dog]
          description: Type of animal
        breed:
          type: string
          description: Breed or species name
        size:
          type: string
          description: Size of the pet (optional, typically used for Dog)
          nullable: true
        job_id:
          type: string
          readOnly: true
          description: ID of the job this pet belongs to
        photos:
          type: array
          readOnly: true
          description: 반려동물에 첨부된 사진 목록
          items:
            $ref: '#/components/schemas/Photo'
      required:
        - id
        - name
        - age
        - species
        - breed
    CreatePetRequest:
      type: object
      required:
        - name
        - age
        - species
      properties:
        name:
          type: string
          minLength: 2
          maxLength: 20
        age:
          type: integer
          minimum: 1
          maximum: 100
        species:
          type: string
          enum: [Cat, Dog]
          description: Type of animal
        breed:
          type: string
          description: Breed or species name
        size:
          type: string
          description: Size of the pet (required for Dog)
        photo_ids:
          type: array
          items:
            type: string
            format: uuid
          description: POST /photos/upload 으로 사전 업로드한 Photo ID 목록
    JobApplication:
      type: object
      properties:
        id:
          type: string
          readOnly: true 
        status:
          type: string
          default: applying 
          enum: 
            - applying
            - approved
            - rejected
        user_id:
          type: string
          readOnly: true 
        job_id:
          type: string
          readOnly: true
      required:
      - id
      - status
      - user_id
      - job_id
    UpdateJobApplicationRequest:
      type: object
      required:
        - status
      properties:
        status:
          type: string
          enum:
            - applying
            - approved
            - rejected
    Session:
      type: object
      properties:
        user_id:
          type: string
        auth_header:
          type: string
    Photo:
      type: object
      properties:
        id:
          type: string
          readOnly: true
        url:
          type: string
          description: Publicly accessible URL for the photo
        file_name:
          type: string
          description: Stored file name (UUID-based)
        original_name:
          type: string
          description: Original uploaded file name
        mime_type:
          type: string
          enum: [image/jpeg, image/png, image/webp]
        size:
          type: integer
          description: File size in bytes
        uploader_id:
          type: string
          readOnly: true
        user_id:
          type: string
          nullable: true
          description: Profile photo target user ID
        job_id:
          type: string
          nullable: true
          description: Associated job ID
        pet_id:
          type: string
          nullable: true
          description: Associated pet ID
        createdAt:
          type: string
          format: date-time
          readOnly: true
      required:
        - id
        - url
        - file_name
        - original_name
        - mime_type
        - size
        - uploader_id
        - createdAt
    Review:
      type: object
      properties:
        id:
          type: string
          readOnly: true
        rating:
          type: integer
          minimum: 1
          maximum: 5
          description: 별점 (1~5)
        comment:
          type: string
          nullable: true
          description: 리뷰 텍스트 (선택)
        reviewer_id:
          type: string
          readOnly: true
          description: 작성자 ID (PetOwner 또는 PetSitter)
        reviewee_id:
          type: string
          readOnly: true
          description: 대상자 ID (PetSitter 또는 PetOwner)
        job_id:
          type: string
          readOnly: true
          description: 관련 공고 ID
        createdAt:
          type: string
          format: date-time
          readOnly: true
        updatedAt:
          type: string
          format: date-time
          readOnly: true
      required:
        - id
        - rating
        - reviewer_id
        - reviewee_id
        - job_id
        - createdAt
        - updatedAt
    CreateReviewRequest:
      type: object
      required:
        - rating
      properties:
        rating:
          type: integer
          minimum: 1
          maximum: 5
          description: 별점 (1~5)
        comment:
          type: string
          description: 리뷰 텍스트 (선택)
    ToggleFavoriteRequest:
      type: object
      required:
        - job_id
      properties:
        job_id:
          type: string
          format: uuid
          description: 즐겨찾기에 추가/제거할 공고 ID
    ToggleFavoriteResult:
      type: object
      properties:
        added:
          type: boolean
          description: true이면 즐겨찾기 추가, false이면 즐겨찾기 제거됨
      required:
        - added
    Favorite:
      type: object
      properties:
        id:
          type: string
          readOnly: true
        user_id:
          type: string
          readOnly: true
        job_id:
          type: string
          readOnly: true
        createdAt:
          type: string
          format: date-time
          readOnly: true
      required:
        - id
        - user_id
        - job_id
        - createdAt
    OASError:
      type: object
      properties:
        message:
          type: string
          description: Human-readable error message
        errors:
          type: array
          items:
            type: object
            properties:
              path:
                type: string
                description: For input validation errors, identifies where in the JSON request body the error occured
              message:
                type: string
                description: Human-readable error message
              errorCode:
                type: string
                description: Code indicating error type
    Problem: 
      type: object
      properties:
        type:
          type: string
          description: URI indicating error type
        title:
          type: string
          description: Human-readable error title
        status:
          type: integer
          description: HTTP status code
        detail:
          type: string
          description: Human-readable error details
        instance:
          type: string
          description: URI indicating error instance
  securitySchemes:
    SessionToken:
      type: apiKey
      in: header
      name: Authorization
security:
  - SessionToken: []